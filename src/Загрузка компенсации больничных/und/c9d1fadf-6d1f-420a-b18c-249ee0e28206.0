{3,
{49,0,0,0,0,1,0,0,00000000-0000-0000-0000-000000000000,1,
{1,0},0,0,1,1,1,0,0,0,
{1,9f2e5ddb-3492-4f5d-8f0d-416b8d1d5c5b,"ПриСозданииНаСервере",1,0,9f2e5ddb-3492-4f5d-8f0d-416b8d1d5c5b,0,1},
{0},1,
{22,
{-1,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,9,"ФормаКоманднаяПанель",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{0,0,1},0,1,0,0,0,3,3,0},7,77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{1,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"ФайлЗагрузки",1,0,
{1,0},
{1,0},
{2,
{1},
{0,20c276b4-5871-4c17-bebc-fcba65f96503}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,2,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,1,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{1,1960479b-4d89-4eba-8b39-0aa802020558,"ФайлЗагрузкиНачалоВыбора",1,0,1960479b-4d89-4eba-8b39-0aa802020558,0,1},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{2,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"ФайлЗагрузкиКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{3,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ФайлЗагрузкиРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{4,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"Организация",1,0,
{1,0},
{1,0},
{2,
{1},
{0,86e009dd-7b0c-4945-b899-2d45cd4aaf15}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,2,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,2,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{5,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"ОрганизацияКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{6,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ОрганизацияРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{7,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"Начисление",1,0,
{1,0},
{1,0},
{2,
{1},
{0,4c12d58e-24fc-489f-b1c8-2100773f0fc8}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,2,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,2,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{8,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"НачислениеКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{9,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"НачислениеРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{10,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"ДатаНачисления",1,0,
{1,0},
{1,0},
{2,
{1},
{0,3af20d71-99a1-4b56-82d4-53d08ffee78d}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,1,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,2,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{11,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"ДатаНачисленияКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{12,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ДатаНачисленияРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{15,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"ПланируемаяДатаВыплаты",1,0,
{1,0},
{1,0},
{1,
{3}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,1,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,2,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{16,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"ПланируемаяДатаВыплатыКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{17,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ПланируемаяДатаВыплатыРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},77ffcc29-7f2d-4223-b22f-19666e7250ba,
{34,
{18,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,1,
{0,
{0,
{"B",1},0}
},2,"ХарактерВыплаты",1,0,
{1,0},
{1,0},
{1,
{2}
},
{0},1,0,2,0,2,
{1,0},
{1,0},1,1,0,3,0,3,1,3,0,
{4,0,
{0},"",-1,-1,1,0,""},
{4,0,
{0},"",-1,-1,1,0,""},
{3,4,
{0}
},
{7,3,0,1,100},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{32,
{3,0},0,0,2,2,1,2,2,2,2,2,2,2,2,2,
{"U"},
{"U"},"",0,
{4,0,
{0},"",-1,-1,1,0,""},0,0,2,3,00000000-0000-0000-0000-000000000000,
{5004,0},
{0,0},2,
{1,0},
{1,0},2,1,0,
{"Pattern"},1,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},1,
{3,0,0},0,
{1,0},2,0,2,0,1,0,0,1,0,0,0,0,0,0,0,0,0},
{0,1,0},1,
{22,
{19,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,8,"ХарактерВыплатыКонтекстноеМеню",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{1,1},0,1,0,0,0,3,3,0},1,
{"Pattern"},
{"Pattern"},"","",
{0},0,0,1,
{11,
{20,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ХарактерВыплатыРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},3,3,0},a9f3b1ac-f51b-431e-b102-55a69acdecad,
{29,
{13,02023637-7868-4a5f-8576-835a76e0c9ba},0,1,
{0,
{0,
{"B",1},0}
},1,"Загрузить",
{1,0},1,
{1,409b9a53-7f7e-4178-86c1-33176c7c7a7a},
{0},3,0,0,0,2,2,0,0,0,
{3,4,
{0}
},
{3,4,
{0}
},
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,
{4,0,
{0},"",-1,-1,1,0,""},1,
{"Pattern"},"",2,0,1,
{11,
{14,02023637-7868-4a5f-8576-835a76e0c9ba},0,0,0,0,"ЗагрузитьРасширеннаяПодсказка",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},
{"U"},1,0,0,1,0,0,0,3,3,3,0,0,1,0,0},"","",1,
{22,
{0},0,0,0,7,"Navigator",
{1,0},
{1,0},0,1,0,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},0,0,1,0,1,
{11,
{0},0,0,0,0,"NavigatorExtendedTooltip",
{1,0},
{1,0},1,0,0,2,2,
{3,4,
{0}
},
{7,3,0,1,100},
{0,0,0},1,
{5,0,0,3,0,
{0,1,0},
{3,4,
{0}
},
{3,4,
{0}
},
{3,0,
{0},0,1,0,48312c09-257f-4b29-b280-284dd89efc1e}
},0,1,2,
{1,
{1,0},0},0,0,1,0,0,1,0,3,3,0},0,3,3,0},1,"",0,0,0,0,0,0,3,3,0,0,0,100,1,1,0,0,0,
{49,0}
},"&НаКлиенте
Перем ВСообщение;
&НаКлиенте
Перем Лог;
&НаКлиенте
Перем Всплывающее;
&НаКлиенте
Перем КаталогИмпорта;


&НаКлиенте
Процедура Загрузить(Команда)
	Объект.Excel.Очистить();
	ВывестиСообщение(ВСообщение,""-------------------------"");
	ВывестиСообщение(Лог+ВСообщение,""Начало загрузки премий"");
	ВывестиСообщение(Лог+ВСообщение,""-------------------------"");
	Отменить=Ложь;
	Если СокрЛП(Объект.ФайлЗагрузки)="""" Тогда
		ВывестиСообщение(ВСообщение,""Файл для импорта не выбран."");
		Отменить=Истина;
	КонецЕсли;
	ФС=Новый Файл(Объект.ФайлЗагрузки);
	Если НЕ ФС.Существует() Тогда
		ВывестиСообщение(Лог+ВСообщение,""Файл для импорта не существует."");
		Отменить=Истина;
	КонецЕсли;
	Если Объект.Организация.Пустая() Тогда
		ВывестиСообщение(Лог+ВСообщение,""Организация не выбрана."");
		Отменить=Истина;
	КонецЕсли;
	Если Объект.Начисление.Пустая() Тогда
		ВывестиСообщение(Лог+ВСообщение,""Основное начисление не выбрано."");
		Отменить=Истина;
	КонецЕсли;
	Если не ЗначениеЗаполнено(Объект.ДатаНачисления) Тогда
		ВывестиСообщение(Лог+ВСообщение,""Дата начисления не выбрана."");
		Отменить=Истина;
	КонецЕсли;
	
	Если Отменить Тогда
		ВывестиСообщение(?(СокрЛП(Объект.ФайлЗагрузки)="""",0,Лог)+ВСообщение+Всплывающее,""Импорт отменен."");
		Возврат;
	КонецЕсли;
	
	ПрочитатьТабличныйДокументИзExcel(Объект.ФайлЗагрузки, 1);
	
	МассивДокументов = Новый Массив;
	Загрузить_Сервер(МассивДокументов);
	Для Каждого Документ Из МассивДокументов Цикл 
		ФормаДокумента = ПолучитьФорму(""Документ.РазовоеНачисление.ФормаОбъекта"", новый Структура(""Ключ"",Документ));
		ФормаДокумента.ПерезаполнитьДанныеФормыНаСервере(ПолучитьМассивСотрудников(Документ),Ложь);
		ФормаДокумента.Записать();
	КонецЦикла;
	
	ВывестиСообщение(Лог+ВСообщение,""Импорт завершен в ""+ТекущаяДата());
	ВывестиСообщение(Всплывающее,""Импорт завершен."");

КонецПроцедуры

&НаСервере
Функция ПолучитьМассивСотрудников(Документ)
	Возврат Документ.Начисления.ВыгрузитьКолонку(""Сотрудник"");
КонецФункции

&НаКлиенте
Процедура ВывестиСообщение (СпособВывода,Сообщение)
	Выводить=СпособВывода;
	Если Выводить>=8 Тогда
		Выводить=Выводить-8;
	КонецЕсли;
	Если Выводить>=4 Тогда
		//ВСообщение
		Выводить=Выводить-4;
		Сообщить(Сообщение);
	КонецЕсли;
	Если Выводить>=2 Тогда
		//Статус
		Выводить=Выводить-2;
		Сообщение = Новый СообщениеПользователю();
		Сообщение.Текст = Строка(Сообщение);
		Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
		Сообщение.Сообщить();
	КонецЕсли;
	Если Выводить>=1 Тогда
		//Всплывающее
		Выводить=Выводить-1;
		Сообщение = Новый СообщениеПользователю();
		Сообщение.Текст = Строка(Сообщение);
		Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
		Сообщение.Сообщить();
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура Загрузить_Сервер(МассивДокументов);
	
	ТаблицаДанных = Новый ТаблицаЗначений;
	ТаблицаДанных.Колонки.Добавить(""ДатаНачала"");
	ТаблицаДанных.Колонки.Добавить(""ДатаОкончания"");
	ТаблицаДанных.Колонки.Добавить(""Сотрудник"");
	ТаблицаДанных.Колонки.Добавить(""Подразделение"");
	ТаблицаДанных.Колонки.Добавить(""Результат"");
		
	//обработка файла
	//Загружаем = ПрочитатьТабличныйДокументИзExcel(Объект.ФайлЗагрузки, 1);
	Для Каждого Стр Из Объект.Excel Цикл
		
		ФИО=Стр.ФИО;
		ТабНомер=Стр.ТабНомер;
		Попытка
			Сумма=Число(Стр.Сумма);
		Исключение
			Сообщение = Новый СообщениеПользователю();
			Сообщение.Текст = ""Неверный формат суммы в строке ""+Стр.НомерСтроки+"": ""+Стр.Сумма+"". Импорт отменен."";
			Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
			Сообщение.Сообщить();
			Возврат;
		КонецПопытки;
		
		Сотр=Справочники.Сотрудники.НайтиПоКоду(ТабНомер);
		Если Сотр.Пустая() Тогда
			Сообщение = Новый СообщениеПользователю();
			Сообщение.Текст =  ""Сотрудник с табельным номером ""+ТабНомер+"" не найден. Импорт отменен."";
			Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
			Сообщение.Сообщить();
			Возврат;
		ИначеЕсли СокрЛП(ФИО)<>СокрЛП(Сотр.Наименование) Тогда
			Сообщение = Новый СообщениеПользователю();
			Сообщение.Текст = ""ФИО сотрудника в файле в строке ""+Стр.НомерСтроки+"": ""+ФИО+"".""+Символы.ВК+Символы.ПС+
			""ФИО сотрудника в базе: ""+Сотр.Наименование+"";""+Символы.ВК+Символы.ПС+
			""Несовпадение ФИО. Импорт отменен"";
			Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
			Сообщение.Сообщить();
			Возврат;
		КонецЕсли;			
		НоваяСтрока = ТаблицаДанных.Добавить();
		НоваяСтрока.Сотрудник 	= Сотр;
		Запрос = Новый Запрос;
		Запрос.Текст = ""ВЫБРАТЬ
		               |	ТекущиеКадровыеДанныеСотрудников.Сотрудник,
		               |	ТекущиеКадровыеДанныеСотрудников.ТекущееПодразделение
		               |ИЗ
		               |	РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		               |ГДЕ
		               |	ТекущиеКадровыеДанныеСотрудников.Сотрудник = &Сотрудник
		               |	И ТекущиеКадровыеДанныеСотрудников.ТекущаяОрганизация = &Организация"";
		
		Запрос.УстановитьПараметр(""Сотрудник"", Сотр);
		Запрос.УстановитьПараметр(""Организация"",Объект.Организация );
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		Пока Выборка.Следующий() Цикл
			
			НоваяСтрока.Подразделение=Выборка.ТекущееПодразделение;	
			
		КонецЦикла;

		НоваяСтрока.Результат	= Сумма;
		НоваяСтрока.ДатаНачала   = ИзвлечьДату(Стр.ДатаНачала);
		НоваяСтрока.ДатаОкончания   = ИзвлечьДату(Стр.ДатаОкончания);
		
	КонецЦикла;
	
	ТаблицаДат = Новый ТаблицаЗначений;
	ТаблицаДат.Колонки.Добавить(""ДатаНачала"");
	ТаблицаДат.Колонки.Добавить(""ДатаОкончания"");
	ТаблицаДат.Колонки.Добавить(""Подразделение"");
	
	Для Каждого СтрокаДанных из ТаблицаДанных Цикл 
		НоваяСтрока = ТаблицаДат.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДанных);
	КонецЦикла;
	
	ТаблицаДат.Свернуть(""ДатаНачала, ДатаОкончания"");
	
	Для Каждого Даты из ТаблицаДат Цикл 
		
		Отбор = Новый Структура(""ДатаНачала, ДатаОкончания"", Даты.ДатаНачала, Даты.ДатаОкончания);
		ТаблицаСОтбором = ТаблицаДанных.Скопировать(Отбор);
		
		ДокументСоздан = Ложь;
		
		Для Каждого СтрокаДанных Из ТаблицаСОтбором Цикл 
			
			Если Не ДокументСоздан Тогда 
				
				ДокНЗ=Документы.РазовоеНачисление.СоздатьДокумент();
				ДокНЗ.МесяцНачисления				= НачалоМесяца(Объект.ДатаНачисления);
				ДокНЗ.Дата 							= Объект.ДатаНачисления;
				ДокНЗ.Организация					= Объект.Организация;
				ДокНЗ.Ответственный					= ПараметрыСеанса.ТекущийПользователь;
				ДокНЗ.Начисление		 			= Объект.Начисление;
				ДокНЗ.Подразделение					= Справочники.ПодразделенияОрганизаций.НайтиПоКоду(""Штат"");;
				ДокНЗ.ДатаНачала				 	= НачалоМесяца(Объект.ДатаНачисления);
				ДокНЗ.ДатаОкончания 				= КонецМесяца(Объект.ДатаНачисления);
				ДокНЗ.ПланируемаяДатаВыплаты		= ПланируемаяДатаВыплаты;
				ДокНЗ.ПорядокВыплаты				= ХарактерВыплаты;
				ДокНЗ.Начислено						= ТаблицаСОтбором.Итог(""Результат"");				
				ДокументСоздан = Истина;
				
			КонецЕсли;
						
			СтрокаНачислений = ДокНЗ.Начисления.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНачислений, СтрокаДанных);
			СтрокаНачислений.ПериодРегистрацииВремени = СтрокаНачислений.ДатаНачала;
			СтрокаНачислений.ПериодДействия	= СтрокаНачислений.ДатаНачала;
			
		КонецЦикла;
		
		Если ДокументСоздан Тогда 
			ДокНЗ.Записать(РежимЗаписиДокумента.Запись);
			МассивДокументов.Добавить(ДокНЗ.Ссылка);
			Сообщение = Новый СообщениеПользователю();
			Сообщение.Текст = ""Создан документ ""+Строка(ДокНЗ);
			Сообщение.УстановитьДанные(ЭтотОбъект.ЭтаФорма);
			Сообщение.Сообщить();
		КонецЕсли;
		
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ПрочитатьТабличныйДокументИзExcel(ИмяФайла, НомерЛистаExcel) 
	
	Сообщить(""Читается файл ""+ИмяФайла+""..."");
	
	xlLastCell = 11;
	
	ВыбФайл = Новый Файл(ИмяФайла);
	Если НЕ ВыбФайл.Существует() Тогда
		Сообщить(""Файл не существует!"");
		Возврат;
	КонецЕсли;                               
	
	Попытка
		Excel = Новый COMОбъект(""Excel.Application"");
		Excel.WorkBooks.Open(ИмяФайла);
		//Состояние(""Обработка файла Microsoft Excel..."");
		ExcelЛист = Excel.Sheets(НомерЛистаExcel);
	Исключение
		Сообщить(""Ошибка. Возможно неверно указан номер листа книги Excel."");
		Возврат;
		
	КонецПопытки;
	
	//ТабЗнач=Новый ТаблицаЗначений;
	
	ActiveCell = Excel.ActiveCell.SpecialCells(xlLastCell);
	RowCount = ActiveCell.Row;
	ColumnCount = ActiveCell.Column;
	КоличествоКолонок = 0;
	Для Column = 1 По ColumnCount Цикл
		ИмяКолонки=СокрЛП(ExcelЛист.Cells(1,Column).Text);
		ИмяКолонки=СтрЗаменить(ИмяКолонки,"" "","""");
		Если ИмяКолонки="""" Тогда
			Прервать
		Иначе
			КоличествоКолонок = КоличествоКолонок + 1;
		КонецЕсли;
	КонецЦикла;
	Для Row = 2 По RowCount Цикл
		ТабСтр=Объект.Excel.Добавить();
		ВсеПустые=Истина;
		Для Column = 1 По КоличествоКолонок Цикл
			Значение=СокрЛП(ExcelЛист.Cells(Row,Column).Text);
			Если Column=1 И Лев(Значение,1)=""("" И Найти(ВРЕГ(ИмяФайла),""EMPLOYEEMOVE"")>0 Тогда
				Прервать
			КонецЕсли;
			ИмяКолонки=СокрЛП(ExcelЛист.Cells(1,Column).Text);
			ИмяКолонки=СтрЗаменить(ИмяКолонки,"" "","""");
			ТабСтр[ИмяКолонки]=?(Значение=""NULL"",Неопределено,Значение);
			Если ТабСтр[ИмяКолонки]<>"""" И ТабСтр[ИмяКолонки]<>Неопределено Тогда
				ВсеПустые=Ложь
			КонецЕсли;
		КонецЦикла;
		Если ВсеПустые Тогда
			Объект.Excel.Удалить(Объект.Excel.Количество()-1);
			Прервать
		КонецЕсли;
	КонецЦикла;
	
	Excel.WorkBooks.Close();
	Excel = 0;
	
КонецПроцедуры 

&НаСервере
Функция ИзвлечьДату (Исходное)
	Возврат Дата(Число(Сред(Исходное,7,4)),Число(Сред(Исходное,4,2)),Число(Сред(Исходное,1,2)));
КонецФункции

&НаКлиенте
Процедура ФайлЗагрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	ВыборФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ВыборФайла.Заголовок = ""Выберите файл с информацией о продавцах"";
	ВыборФайла.ПроверятьСуществованиеФайла = Истина;
	ВыборФайла.Каталог = КаталогИмпорта;
	ВыборФайла.Фильтр = ""Файлы XLS (*.xls,*.xlsx)|*.xls?"";
	
	Если Не ВыборФайла.Выбрать() Тогда
		Возврат;
	Иначе
		Объект.ФайлЗагрузки = ВыборФайла.ПолноеИмяФайла
	КонецЕсли;
	
	КаталогИмпорта = ВыборФайла.Каталог;
	//ИмяРеестра = РаботаСФайлами.ПолучитьИмяФайлаИзПолногоПути(ВыборФайла.ПолноеИмяФайла);

КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Объект.Организация = Справочники.Организации.ОрганизацияПоУмолчанию();
	Объект.ДатаНачисления = ТекущаяДата();
	ПланируемаяДатаВыплаты = Объект.ДатаНачисления;
	ХарактерВыплаты = Перечисления.ХарактерВыплатыЗарплаты.Зарплата;
	Объект.Начисление = ПланыВидовРасчета.Начисления.НайтиПоКоду(""ДКПВР"");
КонецПроцедуры

ВСообщение=4;
Лог=8;
Всплывающее=1;
КаталогИмпорта="""";",
{4,3,
{9,
{1},0,"Объект",
{1,0},
{"Pattern",
{"#",176bd8bc-5939-4da8-ba76-91db2a61bd9c}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},1,0,0,0,
{0,0},
{0,0}
},
{9,
{2},0,"ХарактерВыплаты",
{1,1,
{"ru","Характер выплаты"}
},
{"Pattern",
{"#",4e72fc2e-f96f-4d05-8351-129db087def8}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},
{9,
{3},0,"ПланируемаяДатаВыплаты",
{1,1,
{"ru","Планируемая дата выплаты"}
},
{"Pattern",
{"D","D"}
},
{0,
{0,
{"B",1},0}
},
{0,
{0,
{"B",1},0}
},
{0,0},
{0,0},0,0,0,0,
{0,0},
{0,0}
},0,0,
{#base64:77u/PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxTZXR0
aW5ncyB4bWxucz0iaHR0cDovL3Y4LjFjLnJ1LzguMS9kYXRhLWNvbXBvc2l0aW9u
LXN5c3RlbS9zZXR0aW5ncyIgeG1sbnM6ZGNzY29yPSJodHRwOi8vdjguMWMucnUv
OC4xL2RhdGEtY29tcG9zaXRpb24tc3lzdGVtL2NvcmUiIHhtbG5zOnN0eWxlPSJo
dHRwOi8vdjguMWMucnUvOC4xL2RhdGEvdWkvc3R5bGUiIHhtbG5zOnN5cz0iaHR0
cDovL3Y4LjFjLnJ1LzguMS9kYXRhL3VpL2ZvbnRzL3N5c3RlbSIgeG1sbnM6djg9
Imh0dHA6Ly92OC4xYy5ydS84LjEvZGF0YS9jb3JlIiB4bWxuczp2OHVpPSJodHRw
Oi8vdjguMWMucnUvOC4xL2RhdGEvdWkiIHhtbG5zOndlYj0iaHR0cDovL3Y4LjFj
LnJ1LzguMS9kYXRhL3VpL2NvbG9ycy93ZWIiIHhtbG5zOndpbj0iaHR0cDovL3Y4
LjFjLnJ1LzguMS9kYXRhL3VpL2NvbG9ycy93aW5kb3dzIiB4bWxuczp4cz0iaHR0
cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOnhzaT0iaHR0cDov
L3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2UiPg0KCTxvdXRwdXRQ
YXJhbWV0ZXJzLz4NCjwvU2V0dGluZ3M+}
},
{0,0},
{0,1,
{9,
{1,409b9a53-7f7e-4178-86c1-33176c7c7a7a},"Загрузить",
{1,1,
{"ru","Загрузить"}
},
{1,1,
{"ru","Загрузить"}
},
{0,
{0,
{"B",1},0}
},
{0,0,0},
{4,0,
{0},"",-1,-1,1,0,""},"Загрузить",3,0,0,
{0,0},1,0,1,0,0,1}
},
{0,0},
{0,0},0,0}